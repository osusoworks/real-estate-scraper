# 不動産スクレイピングツール v2 - 新機能

## 追加された機能

### 1. **取得済みスキップ機能** ⭐

既に取得した物件を自動的にスキップします。

#### 仕組み

- 取得した物件番号を `scraping_history.json` に記録
- 次回実行時、既に取得済みの物件はスキップ
- 新規物件のみを取得するため、時間を大幅に短縮

#### 使い方

1. **「取得済み物件をスキップする」にチェック**（デフォルトでON）
   - 既に取得した物件をスキップ
   - 新規物件のみ取得

2. **チェックを外す**
   - すべての物件を再取得
   - 情報が更新されている可能性がある場合に使用

#### 取得済み件数の表示

設定画面に「（取得済み: XX件）」と表示されます。

### 2. **履歴クリア機能**

取得履歴をリセットできます。

#### 使い方

1. 「履歴クリア」ボタンをクリック
2. 確認ダイアログで「はい」を選択
3. 取得履歴がクリアされ、次回実行時にすべての物件を再取得

#### 使用シーン

- 物件情報が更新されたため、すべて再取得したい
- データベースをリセットしたい
- テスト実行後、本番実行前にクリアしたい

### 3. **データの自動マージ**

新規取得したデータを既存のCSV/JSONに自動的に追加します。

#### 仕組み

- 既存の `export.csv` がある場合、新規データを追加
- 物件番号で重複チェック
- 同じ物件番号がある場合、最新のデータで上書き

#### メリット

- 過去のデータを保持しながら、新規データを追加
- 手動でデータを結合する必要がない
- 常に最新の情報を保持

### 4. **詳細なログ表示**

実行状況をリアルタイムで確認できます。

#### 表示内容

- 取得済みスキップモードのON/OFF
- スキップした物件番号
- 新規取得した物件番号
- 最終的な統計情報：
  - 新規取得件数
  - スキップ件数
  - 合計件数

#### 例

```
[12:34:56] 📋 取得済みスキップモード: ON（25件スキップ）
[12:34:57] [1/50] ⏭️ スキップ: 物件番号 4446916（取得済み）
[12:34:58] [2/50] 処理中: https://...
[12:35:00]   ✓ 物件番号 4447123 - 画像11枚取得
...
[12:40:00] 🎉 完了:
[12:40:00]   新規取得: 5件
[12:40:00]   スキップ: 45件
[12:40:00]   合計: 50件（CSV/JSON）
```

## 使用例

### 初回実行

```
1. 取得件数: 50
2. ✅ 取得済み物件をスキップする
3. 「スクレイピング開始」をクリック
```

**結果:**
- 50件すべてを取得
- `scraping_history.json` に50件記録

### 2回目実行（翌日）

```
1. 取得件数: 50
2. ✅ 取得済み物件をスキップする
3. 「スクレイピング開始」をクリック
```

**結果:**
- 既存の50件はスキップ
- 新規物件（例: 5件）のみ取得
- 合計55件のデータ

### 全件再取得

```
1. 「履歴クリア」をクリック
2. 取得件数: 999
3. ✅ 取得済み物件をスキップする
4. 「スクレイピング開始」をクリック
```

**結果:**
- すべての物件を再取得
- 最新の情報で更新

## ファイル構成

```
プロジェクトフォルダ/
├── scraper_gui_v2.py          # v2プログラム本体
├── scraping_history.json      # 取得履歴（自動生成）
├── export.csv                 # 物件データ（CSV）
├── export.json                # 物件データ（JSON）
└── images/                    # 物件画像フォルダ
    ├── 4446916_1.jpg
    ├── 4446916_2.jpg
    └── ...
```

## scraping_history.json の内容

```json
{
  "scraped_ids": [
    "4446916",
    "4447123",
    "4447456",
    ...
  ],
  "last_updated": "2025-10-15 12:40:00"
}
```

## v1からの変更点

| 項目 | v1 | v2 |
|------|----|----|
| 取得済みスキップ | ❌ なし | ✅ あり |
| 履歴管理 | ❌ なし | ✅ あり |
| データマージ | ❌ 上書き | ✅ 自動マージ |
| 統計情報 | ⚠️ 簡易 | ✅ 詳細 |
| タイトル | v1 | v2 |

## 注意事項

### 1. 履歴ファイルの管理

`scraping_history.json` を削除すると、すべての物件を再取得します。

### 2. 物件番号の変更

サイト側で物件番号が変更された場合、別の物件として扱われます。

### 3. データの更新

取得済みの物件情報が更新された場合、スキップモードではその更新を取得できません。定期的に「履歴クリア」して全件再取得することをおすすめします。

## まとめ

v2では、**取得済みスキップ機能**により、以下のメリットがあります：

✅ **時間短縮** - 新規物件のみ取得
✅ **サーバー負荷軽減** - 不要なアクセスを削減
✅ **データ管理** - 自動的にマージ
✅ **使いやすさ** - ワンクリックで履歴クリア

定期的にスクレイピングを実行する場合に特に便利です！

